---
title: "Sentiment analysis of Avatar"
author: "Ted Laderas"
date: "`r Sys.Date()`"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

# Look at the available datasets

```{r}
library(tidytuesdayR)
#This will open up in the help window
tidytuesdayR::tt_available()
```

# What was your dataset?

Load your dataset in with the function below. The input is the date the dataset was issued. You should be able to get this from the `tt_available()` function.

```{r}
#incoming data comes in as a list
datasets <- tidytuesdayR::tt_load("2020-08-11")
#show the names of the individual datasets
names(datasets)
```

```{r}
avatar <- datasets$avatar
avatar[1:5,]
```

```{r}
scenes <- datasets$scene_description
scenes[1:5,]
```

# My Research Question

Does the sentiment of each character change over the multiple seasons? That is, does a character become more positive or more negative as their character develops?

I will attempt to summarize the sentiment of each character across each episode.

Using `tidytext`

```{r}
library(tidytext)
library(tidyverse)

avatar_words <- avatar %>%
  select(id, book, book_num, chapter, chapter_num, character, character_words) %>%
  filter(character != "Scene Description") %>%
  unnest_tokens(word, character_words)

avatar_words[1:10,]
```

# Who Spoke the Most?

Surprisingly, Sokka has the most lines.

```{r}
line_count <- avatar_words %>% 
  count(character) %>%
  arrange(desc(n)) 


line_count[1:20,] %>%
  gt::gt()
```


# Understanding Each Character's Journey

```{r}
bing <- get_sentiments("bing")

characters <- c("Aang", "Katara", "Zuko", "Toph", "Iroh", "Sokka", "Azula", "Mai", "Ty Lee")

sentiment_summary <- avatar_words %>%
  inner_join(bing) %>%
  count(book_num, chapter_num, chapter, character, sentiment) %>%
  filter(character %in% characters) %>%
  arrange(book_num, chapter_num) %>%
  pivot_wider(names_from = sentiment, values_from = n) %>%
  mutate(positive = tidyr::replace_na(positive, 0),
         negative = tidyr::replace_na(negative, 0)) %>%
  mutate(sentiment = positive - negative)
```

```{r}
index_chapters <- avatar_words %>%
  select(book_num, chapter_num) %>%
  distinct() %>%
  mutate(index = row_number())
```

```{r}
sentiment_index <- sentiment_summary %>% 
  inner_join(y= index_chapters, by=c("book_num", "chapter_num"))

```

```{r}
out_plot <- ggplot(sentiment_index) +
  aes(x=index, y=sentiment, fill=character, episode=chapter) +
  geom_col(show_legend = FALSE) +
  facet_wrap(~character, ncol=2) +
  labs(title= "Each Character's Sentiment Journey", x="Episode Number",
       subtitle = "mouse over each graph for more information")

plotly::ggplotly(out_plot)

```

# Zuko has the most interesting journey

```{r}
zuko <- sentiment_index %>%
  filter(character=="Zuko")

out_plot <- ggplot(zuko) +
  aes(x=index, y=sentiment, fill=character, episode=chapter) +
  geom_col(show_legend = FALSE) +
  facet_wrap(~character, ncol=2) +
  labs(title= "Zuko has lots of ups and downs", x="Episode Number",
       subtitle = "mouse over for more episode information")

plotly::ggplotly(out_plot)
```
